<!-- Components JS -->
<script type="module" src="/js/components/piano-component/index.js"></script>
<script type="module" src="/js/components/synth-component/index.js"></script>
<script type="module" src="/js/components/lyrics-list-component/index.js"></script>
<script type="module" src="/js/components/lyrics-editor-component/index.js"></script>
<script type="module" src="/js/components/control-panel-component/index.js"></script>

<!-- Room layout -->
<div class="grid grid-cols-4 h-screen w-screen overflow-hidden">
  <!-- Left side - control panel (25%) -->
  <div class="col-span-1 bg-white flex flex-col items-center p-6 h-full">
    <!-- Logo -->
    <div class="mb-8">
      <img src="/img/icon_pink_2.png" alt="ToneTeam Logo" class="h-18 w-auto">
    </div>

    <!-- Create New Lyrics button -->
    <div class="w-full flex flex-col items-center font-['Oxanium'] space-y-2 mb-8">
      <button id="create-lyrics-btn" class="w-1/2 py-1.5 px-3 bg-purple-100 bg-opacity-30 border border-purple-200 text-purple-700 rounded-full text-sm flex items-center justify-center shadow-sm hover:bg-purple-200 hover:bg-opacity-90 transition-all">
        <span class="font-bold tracking-widest uppercase text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-500 drop-shadow-[0_0_1px_rgba(168,85,247,0.3)]">NEW LYRICS</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-1 text-pink-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
      </button>
    </div>

    <!-- Lyrics List Container - only the list is generated by the component -->
    <div id="lyrics-list-container" class="w-full flex-grow mb-6 overflow-hidden"></div>

    <!-- Logout button at the bottom -->
    <div class="mt-auto w-full flex justify-center font-['Oxanium'] mb-4">
      <button id="logout-btn" class="flex items-center justify-center px-4 py-2 border border-fuchsia-200 rounded-full shadow-sm text-sm font-semibold text-purple-900 bg-white hover:bg-gray-50 w-3/4">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
        </svg>
        Sign Out
      </button>
    </div>

    <!-- User Status Section -->
    <div class="w-full text-center">
      <!-- Subtle line -->
      <div class="w-3/4 mx-auto h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent mb-3"></div>

      <!-- User info with pulsing status -->
      <div class="flex items-center justify-center space-x-2">
        <!-- Pulsing green indicator -->
        <div class="relative">
          <div class="w-2 h-2 bg-green-500 rounded-full"></div>
          <div class="absolute inset-0 w-2 h-2 bg-green-400 rounded-full animate-ping opacity-75"></div>
        </div>
        
        <!-- Connected text -->
        <p class="text-xs text-gray-500">
          <span class="text-gray-600 font-medium max-w-[220px] inline-block truncate align-bottom" title="<%= user.email %>">
            <%= user.email %>
          </span>
        </p>
      </div>
    </div>
  </div>


    <!-- Right side - Piano and editor container (75%) -->
    <div class="col-span-3 relative h-screen">
      <!-- Background image -->
      <img src="/img/background_music_room.png" alt="Music Room" class="absolute inset-0 h-full w-full object-cover">

      <!-- Dark overlay -->
      <div class="absolute inset-0 bg-black bg-opacity-40"></div>

      <!-- Content Container with adjusted vertical layout -->
      <div class="relative z-10 w-full h-full flex flex-col">

        <!-- Lyrics Editor (takes up upper part) -->
        <div class="flex-grow p-6 overflow-hidden flex flex-col">
          <div id="lyrics-editor-container" class="w-full max-w-2xl mx-auto h-full max-h-[66vh] z-20 overflow-auto">
            <!-- Here the lyrics-editor-component is rendered via JavaScript -->
          </div>
        </div>

        <!-- Piano/Synth area (centered at the bottom) -->
        <div class="w-full flex items-end justify-center pb-10 h-[34vh] relative">
          <!-- Control panel positioned to the left -->
          <div id="control-panel-container" class="absolute left-[calc(50%-350px)] bottom-16 z-20"></div>
          
          <!-- Piano container -->
          <div id="piano-container" class="w-full flex items-end justify-center">
            <!-- Piano component will be loaded here -->
          </div>
          
          <!-- Synth container (hidden by default) -->
          <div id="synth-container" class="w-full items-end justify-center hidden">
            <!-- Synth component will be loaded here -->
          </div>
        </div>
      </div>
    </div>
    
<!-- Custom CSS for animations and styling -->
<style>
  /* Text shadow utility */
  .text-shadow {
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
  }
  
  /* Piano position adjustment */
  #piano-wrapper {
    transform: scale(1.0);
  }

 /* Synth position adjustment */
  #synth-wrapper {
  transform: scale(1.0);
}
</style>

<!-- Logout script -->
<script type="module">
  import { signOut } from '/js/firebase/firebase.js';
  
  document.addEventListener('DOMContentLoaded', () => {
    const logoutBtn = document.getElementById('logout-btn');
    
    if (logoutBtn) {
      logoutBtn.addEventListener('click', async () => {
        try {
          const result = await signOut();
          
          if (result.success) {
            // Clear session on server side
            await fetch('/users/logout', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              }
            });
            
            window.location.href = '/';
          } else {
            console.error('Logout failed:', result.error);
            alert('Logout failed. Please try again.');
          }
        } catch (error) {
          console.error('Error during logout:', error);
          alert('An error occurred. Please try again.');
        }
      });
    }

    // Listens for clicks on the "New Lyrics" button
    const createLyricsBtn = document.getElementById('create-lyrics-btn');
    if (createLyricsBtn) {
      createLyricsBtn.addEventListener('click', () => {
        document.dispatchEvent(new CustomEvent('lyrics:new'));
      });
    }
  });
</script>

<script type="module">
  import { initInstrumentSwitcher } from '/js/utils/instrument-switcher.js';
  initInstrumentSwitcher();
</script>